storage
\_ partition
   \_ index_table
      \_ set<document_identifier>  map to  <document_local_file>


document_identifier status:
  'creating', 'normal', 'updating', 'deleting'

upsert flow:
\=> build: partition, index_table
 \=> find there is yet no this document id
 |\=> build document_local_file, identifier, mark identifier as 'creating', assign etag 
 | \=> insert identifier to document_id table
 |  \=> insert identifier to every index_table
 |   \=> mark identifier as 'normal'
 |    \=> succeed
 |
 |=> find there is this document id
  \=> find identifier status is 'normal'
  |\=> mark identifier as 'updating'
  | \=> find etag conflict
  | |\=> mark identifier as 'normal'
  | | \=> fail
  | |
  | |=> find etag consistent
  |  \=> build new document_local_file, identifier
  |   \=> mark identifier as 'creating', assign etag
  |    \=> insert identifier to document_id table
  |     \=> insert identifier to every index_table
  |      \=> record identifier pair
  |       \=> mark new identifier from 'creating' to 'normal'
  |        \=> remove old identifier
  |         \=> succeed
  |
  |=> find identifier status is 'updating'
  |\=> find etag conflict
  | \=> fail
  |
  |=> find identifier status is 'deleting'
   \=> build new document_local_file, identifier
    \=> mark identifier as 'creating'
     \=> insert identifier to document_id table
      \=> insert identifier to every index table
       \=> mark identifier as 'normal'
        \=> succeed

delete flow:
\=> find document_id don't exist
|\=> fail
|
|=> find document_id
 \=> mark identifier as 'deleting'
  \=> remove identifier from document_id table
   \=> remove identifier from every index_table
    \=> release identifier and document_local_file
     \=> succeed































